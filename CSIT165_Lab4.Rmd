---
title: "Lab 4: 2019 Novel Coronavirus"
author: "Name: Sal Figueroa"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    toc: true
    toc_depth: 3
header-includes:
#These packages are not necessary to complete the assignment and or only used to provide an example. 
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
#  - \usepackage{tabu}  #when tabu package enabled PDF won't knit
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage{xcolor}

---

```{r setup, include = FALSE}
#### Load necessary library ####
packages <- c("knitr", "kableExtra", "magrittr", "readr", "geosphere")

install_me <- packages[!(packages %in% installed.packages()[, "Package"])]
if (length(install_me)) install.packages(install_me)

library(knitr)
#library(kableExtra) #when kablextra library enabled PDF won't knit
library(magrittr)
library(readr)
library(geosphere)
```


```{r Data setup, include = FALSE}
#time_series_covid19_confirmed_US.csv
Confirmed_US <- as.data.frame(read.csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/refs/heads/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"))

rowmax_Conf <- nrow(Confirmed_US[,]) #limit Qty of Rows 289
colmax_Conf <- ncol(Confirmed_US[,]) #limit Qty of Rows 289

#time_series_covid19_deaths_US.csv
Deaths_US <- as.data.frame(read.csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/refs/heads/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"))


rowmax_Deaths <- nrow(Deaths_US[,]) #limit Qty of Rows 289
colmax_Deaths <- ncol(Deaths_US[,]) #limit Qty of Rows 289

#cat("Test VAR - Confirmed:",rowmax_Conf,",",colmax_Conf,", Deaths:",rowmax_Deaths,",",colmax_Deaths,"\n")
```


## Github Repository
*Holds all related files*

[github: Figgs0bit-Lab4 (https://github.com/Figgs0bit/CSIT165-Lab4.git)](https://github.com/Figgs0bit/CSIT165-Lab4.git)


## Required data sets

[2019 Novel Coronavirus COVID-19 (2019-nCoV) Data Repository by John Hopkins CSSE](https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series)

*The following data set is operated by the John Hopkins University Center for Systems Science and Engineering (JHU CSSE). Data sets include daily time series CSV summary tables for confirmations and deaths associated with COVID-19. Lat and Long refer to coordinate references for the data field. Date fields are stored in MM/DD/YYYY format.*
*For this laboratory, we will be use confirmed and deaths data sets for the US.*


## Project Objectives

*Before beginning your objectives in your final document, please state which day you downloaded the data sets on for analysis. For this laboratory, use the packages described in Module 10 and 11 to accomplish each objective where appropriate.*
*The surgeon general for the United States recently created a new data science initiative, CSIT-165, that uses data science to characterize pandemic diseases. CSIT-165 disseminates data driven analyses to state governors. You are a data scientist for CSIT-165 and it is up to you and you alone to manipulate and visualize COVID-19 data for disease control.*


### Objective 1
*Which state has the most confirmed cases of COVID-19? Which state has the most deaths?*
```{r ob1}
#cat("Test VAR - Confirmed(row, col):",rowmax_Conf,",",colmax_Conf,", Deaths(row, col):",rowmax_Deaths,",",colmax_Deaths,"\n")
#[j,6] County column
#[j,7] State column
#[j,1155] last column
#rowmax_Conf <- nrow(Confirmed_US[,]) #limit Qty of Rows 289
#colmax_Conf <- ncol(Confirmed_US[,]) #limit Qty of Rows 289
#rowmax_Deaths <- nrow(Deaths_US[,]) #limit Qty of Rows 289
#colmax_Deaths <- ncol(Deaths_US[,]) #limit Qty of Rows 289
#Confirmed_US[i,j] #[3342, 1155]
#Deaths_US[i,j] #[3342, 1154]



V_State <- c() #Will Hold all US States and territories.
V_USconfirmed <- c() #Will Hold all entries of confirmed_US
V_USdeaths <- c() #Will Hold all entries of confirmed_US

sumC <- 0 #resets confirmed_global Sum C after each country multiple
sumD <- 0 #resets deaths_global Sum D after each country multiple



#Data is broken down by county or territory, script must now sort and consolidate common states. 
#The following if else ladder sorts and filters the duplicate
#-counties and combines the data for a common region.
for(j in 1:rowmax_Conf) #Iterate through rows 3342  
{
  #first if conditional is need as the the first row will
  #-not fall through the remaining if statements.
  if(j == 1) 
    { 
      #Adds the incremented value into each respective vector
      V_State <- c(V_State, Confirmed_US[j,colmax_Deaths])#adds State or territory  
      V_USconfirmed <- c(V_USconfirmed, Confirmed_US[j,colmax_Conf])#adds US confirmed
      V_USdeaths <- c(V_USdeaths, Deaths_US[j,colmax_Deaths])#adds US Deaths
    }
  #The following (2) else if statements test and sort through duplicate country 
  #-entries and then sums them together, respectively. 
  else if(Confirmed_US[j,7] %in% Confirmed_US[j+1,7])#conditional for strings
    {
      #When a duplicate country entry is encountered values
      #-are summed up for Confirmed and death cases
      sumC <- sumC + Confirmed_US[j,colmax_Conf]
      sumD <- sumD + Deaths_US[j,colmax_Deaths]
    }
  #conditional statement for strings
  else if((Confirmed_US[j,7] %in% Confirmed_US[j-1,7]) && (Confirmed_US[j,7] != Confirmed_US[j+1,7]))  
    { 
      #When a duplicate country entry is encountered values
      #-are summed up for Confirmed and death cases
      sumC <- sumC + Confirmed_US[j,colmax_Conf]
      sumD <- sumD + Deaths_US[j,colmax_Deaths]
    
      #loads the shorten results with the common countries combined
      V_State <- c(V_State, Confirmed_US[j,colmax_Deaths])#adds State or territory  
      V_USconfirmed <- c(V_USconfirmed, sumC)#adds US confirmed
      V_USdeaths <- c(V_USdeaths, sumD)#adds US Deaths
    
      #resets the following sum variables to zero for the next duplicate country 
      sumC <- 0
      sumD <- 0
    }
  #The last else statement is where countries without duplicates are loaded
  else
    {
      #adds deaths_global, confirmed_global to new vectors 
      V_State <- c(V_State, Confirmed_US[j,colmax_Deaths])#adds State or territory  
      V_USconfirmed <- c(V_USconfirmed, Confirmed_US[j,colmax_Conf])#adds US confirmed
      V_USdeaths <- c(V_USdeaths, Deaths_US[j,colmax_Deaths])#adds US Deaths
    }
}




```


### Objective 2
*Create a new table called current_tally by merging confirmed and deaths containing only the columns iso2, Province_State, Admin2, Lat, Long_, and today’s count for confirmed and deaths. Rename current_tally’s columns as Country, State, City, Lat, Long, Confirmed, and Deaths respectively. Filter current_tally for data points where the country is the US. Please print current_tally as a tibble.*
```{r ob2}

```


### Objective 3
*In current_tally, create a new variable, unaccounted, as the absolute difference between confirmed and deaths for each city. Determine the number of unaccounted for each state using grouped operation.*
```{r ob3}

```



### Objective 4
*Using the package kable, create a table showing the top 5 unnacounted states.*
```{r ob4}

```


### Objective 5
*Create any visualization you like using the data sets used in this laboratory. Provide your visualization with a title and custom axis labels. Describe how this visualization conveys information that is not readily apparent from looking at the data alone.*
```{r ob5}

```
